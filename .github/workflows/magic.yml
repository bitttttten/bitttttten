name: do the magic

on:
    schedule:
        - cron: "0 * * * *"
    workflow_dispatch:

jobs:
    build:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@master
            - uses: denolib/setup-deno@v2
              with:
                  deno-version: v1.x
            - name: Make changes
              env:
                  SPOTIFY_CLIENT_SECRET: ${{ secrets.SPOTIFY_CLIENT_SECRET }}
                  SPOTIFY_REFRESH_TOKEN: ${{ secrets.SPOTIFY_REFRESH_TOKEN }}
                  SPOTIFY_ACCESS_TOKEN: ${{ secrets.SPOTIFY_ACCESS_TOKEN }}
              run: deno run --allow-read=./src,./types,.env,.env.defaults,README.template.md --allow-write --allow-env --allow-net --unstable src/magic.ts
            - name: Commit files
              run: git commit -m "updating readme" -a
            - name: Push changes
              uses: ad-m/github-push-action@master
              with:
                  github_token: ${{ secrets.GITHUB_TOKEN }}
